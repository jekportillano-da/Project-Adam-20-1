<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Budget Buddy - Monthly Bills</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Open+Sans:ital,wght@0,300;0,400;0,600;1,300;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/bills.css') }}">
  <!-- Primary Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  
  <!-- Fallback to alternative CDN if primary fails -->
  <script>
    window.addEventListener('load', function() {
      if (typeof Chart === 'undefined') {
        console.warn('Primary Chart.js CDN failed, trying alternative...');
        var script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js';
        script.onload = function() {
          console.log('Chart.js loaded from fallback CDN. Version:', Chart.version);
        };
        script.onerror = function() {
          console.error('Both Chart.js CDNs failed to load!');
        };
        document.head.appendChild(script);
      } else {
        console.log('Chart.js loaded successfully. Version:', Chart.version);
      }
    });
  </script>
</head>
<body>
  <div class="app-header">
    <div class="header-content">
      <h1>Budget Buddy</h1>
      <p class="subtitle">Smart financial planning made simple</p>
    </div>
    <div class="profile-container">
      <div class="profile-icon" id="profileIcon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
      </div>
      <div class="dropdown-menu" id="profileDropdown">
        <ul class="menu-items">
          <li><a href="#" class="menu-item" id="budget-insights-link">Budget Insights</a></li>
          <li><a href="#" class="menu-item active" id="monthly-bills-link">Monthly Bills</a></li>
          <li><a href="#" class="menu-item disabled">Goals (Coming Soon)</a></li>
          <li><a href="#" class="menu-item disabled">Reports (Coming Soon)</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="app-container">
    <div class="bills-panel">
      <div class="panel-header">
        <h2>Monthly Bills</h2>
        <p>Manage your recurring expenses</p>
      </div>

      <form id="bill-form" class="bill-form">
        <div class="input-group">
          <label for="bill-name">Bill Name</label>
          <input 
            type="text" 
            id="bill-name" 
            placeholder="E.g., Rent, Electricity, Spotify" 
            required
            autocomplete="off">
        </div>

        <div class="input-group">
          <label for="bill-amount">Monthly Amount (PHP)</label>
          <input 
            type="text" 
            id="bill-amount" 
            placeholder="Enter amount (e.g., 1,000)" 
            pattern="^[0-9,]*\.?[0-9]*$"
            required
            autocomplete="off"
            inputmode="numeric">
        </div>

        <div class="input-group">
          <label for="bill-category">Category</label>
          <select id="bill-category">
            <option value="housing">Housing</option>
            <option value="utilities">Utilities</option>
            <option value="transportation">Transportation</option>
            <option value="entertainment">Entertainment</option>
            <option value="insurance">Insurance</option>
            <option value="subscriptions">Subscriptions</option>
            <option value="other">Other</option>
          </select>
        </div>

        <div class="input-group">
          <label for="bill-due-date">Due Date</label>
          <input 
            type="number" 
            id="bill-due-date" 
            min="1"
            max="31"
            placeholder="Day of the month (1-31)"
            autocomplete="off">
        </div>

        <button type="submit" class="submit-btn">Add Bill</button>
      </form>

      <div class="bills-list-container">
        <h3>Your Monthly Bills</h3>
        <p class="empty-message">No bills added yet. Add your first bill above.</p>
        <ul class="bills-list" id="billsList">
          <!-- Bills will be populated here dynamically -->
        </ul>
        <div class="bills-summary">
          <div class="total-bills">
            <span>Total Monthly Bills:</span>
            <span class="total-amount">â‚±0.00</span>
          </div>
        </div>
      </div>
    </div>

    <div class="bills-overview-panel">
      <div class="panel-header">
        <h2>Bills Overview</h2>
        <p>Visual breakdown of your expenses</p>
      </div>

      <div class="chart-options">
        <div class="toggle-container">
          <input type="checkbox" id="showPercentages" class="toggle-checkbox" checked>
          <label for="showPercentages" class="toggle-label">Show Percentages</label>
        </div>
      </div>

      <div class="chart-container">
        <canvas id="billsChart"></canvas>
      </div>
      
      <div class="custom-chart-legend" id="chartLegend"></div>

      <div class="bills-insights">
        <h3>Payment Timeline</h3>
        <div class="timeline-container" id="timelineContainer">
          <div class="timeline-scale">
            <div class="timeline-day">1</div>
            <div class="timeline-day">5</div>
            <div class="timeline-day">10</div>
            <div class="timeline-day">15</div>
            <div class="timeline-day">20</div>
            <div class="timeline-day">25</div>
            <div class="timeline-day">30</div>
          </div>
          <div class="timeline-markers" id="timelineMarkers">
            <!-- Timeline markers will be added here dynamically -->
          </div>
        </div>

        <div class="bills-tips">
          <h3>Budget Tips</h3>
          <div class="tip">
            <div class="tip-icon">ðŸ’¡</div>
            <div class="tip-content">
              <p>Organize your bills by due date to avoid late payment fees.</p>
            </div>
          </div>
          <div class="tip">
            <div class="tip-icon">ðŸ’¸</div>
            <div class="tip-content">
              <p>Review your subscriptions regularly to identify services you no longer use.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="{{ url_for('static', filename='js/dropdown.js') }}"></script>
  <script src="{{ url_for('static', filename='js/bills.js') }}"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Set up navigation links based on demo mode
      const budgetInsightsLink = document.getElementById('budget-insights-link');
      const monthlyBillsLink = document.getElementById('monthly-bills-link');
      
      if (window.demoMode) {
        budgetInsightsLink.href = '/demo';
        monthlyBillsLink.href = '/demo/bills';
      } else {
        budgetInsightsLink.href = '/';
        monthlyBillsLink.href = '/bills';
      }
    });
  </script>
</body>
</html>
